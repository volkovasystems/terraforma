"use strict";var gulp=require("gulp"),del=require("del"),vinylPaths=require("vinyl-paths"),concat=require("gulp-concat"),uglify=require("gulp-uglify"),sourcemaps=require("gulp-sourcemaps"),rename=require("gulp-rename"),changed=require("gulp-changed"),cached=require("gulp-cached"),remember=require("gulp-remember"),newer=require("gulp-newer"),flatten=require("gulp-flatten"),replace=require("gulp-replace"),insert=require("gulp-insert"),react=require("gulp-react"),minifyCSS=require("gulp-minify-css"),less=require("gulp-less"),filter=require("gulp-filter"),livereload=require("gulp-livereload"),embedlr=require("gulp-embedlr"),plumber=require("gulp-plumber"),connect=require("connect"),serveStatic=require("serve-static"),map=require("map-stream"),fs=require("fs"),path=require("path"),argv=require("yargs").argv,terraforma=function(e){var p=new RegExp('(?:\\<\\!\\-\\-\\:)?(\\s*).*?\\@include\\-script\\:(\\"[^\\"]+?\\").*?(\\s*)(?:\\-\\-\\>)?',"g"),l=new RegExp('(?:\\<\\!\\-\\-\\:)?(\\s*).*?\\@include\\-style\\:(\\"[^\\"]+?\\").*?(\\s*)(?:\\-\\-\\>)?',"g"),r=/\.min\./g,i=/\.min\./g,t='$1<script type="text/javascript" src=$2></script>$3',s='$1<link rel="stylesheet" type="text/css" href=$2>$3',a=new RegExp("(?:\\{?\\s*)?(?:\\<\\!\\-\\-\\:|\\/\\*\\:|\\/\\/\\:)?(\\s*).*?\\@production\\-mode\\:(?:\\s*\\*\\/ \\}?)?\\s*([^]+?)\\s*(?:\\{?\\s*\\/\\*\\s*|\\/\\/\\:\\s*)?\\@end\\-production\\-mode.*?(\\s*)(?:\\-\\-\\>|\\*\\/)?(?: \\}?)?","gm"),u="\n$1$2$3\n",n=new RegExp("(?:\\{?\\s*)?(?:\\<\\!\\-\\-\\:|\\/\\*\\:|\\/\\/\\:)?(\\s*).*?\\@development\\-mode\\:(?:\\s*\\*\\/ \\}?)?\\s*([^]+?)\\s*(?:\\{?\\s*\\/\\*\\s*|\\/\\/\\:\\s*)?\\@end\\-development\\-mode.*?(\\s*)(?:\\-\\-\\>|\\*\\/)?(?: \\}?)?","gm"),o="\n$1$2$3\n",c=new RegExp("(?:\\{?\\s*)?(?:\\<\\!\\-\\-\\:|\\/\\*\\:|\\/\\/\\:)?(\\s*).*?\\@client\\-mode\\:(?:\\s*\\*\\/ \\}?)?\\s*([^]+?)\\s*(?:\\{?\\s*\\/\\*\\s*|\\/\\/\\:\\s*)?\\@end\\-client\\-mode.*?(\\s*)(?:\\-\\-\\>|\\*\\/)?(?: \\}?)?","gm"),d="\n$1$2$3\n",m=new RegExp("(?:\\{?\\s*)?(?:\\<\\!\\-\\-\\:|\\/\\*\\:|\\/\\/\\:)?(\\s*).*?\\@administrator\\-mode\\:(?:\\s*\\*\\/ \\}?)?\\s*([^]+?)\\s*(?:\\{?\\s*\\/\\*\\s*|\\/\\/\\:\\s*)?\\@end\\-administrator\\-mode.*?(\\s*)(?:\\-\\-\\>|\\*\\/)?(?: \\}?)?","gm"),b="\n$1$2$3\n",g=new RegExp("(?:\\{?\\s*)?(?:\\<\\!\\-\\-\\:|\\/\\*\\:|\\/\\/\\:)?(\\s*).*?\\@administrator-development\\-mode\\:(?:\\s*\\*\\/ \\}?)?\\s*([^]+?)\\s*(?:\\{?\\s*\\/\\*\\s*|\\/\\/\\:\\s*)?\\@end\\-administrator-development\\-mode.*?(\\s*)(?:\\-\\-\\>|\\*\\/)?(?: \\}?)?","gm"),y="\n$1$2$3\n",v=new RegExp("(?:\\{?\\s*)?(?:\\<\\!\\-\\-\\:|\\/\\*\\:|\\/\\/\\:)?(\\s*).*?\\@administrator-production\\-mode\\:(?:\\s*\\*\\/ \\}?)?\\s*([^]+?)\\s*(?:\\{?\\s*\\/\\*\\s*|\\/\\/\\:\\s*)?\\@end\\-administrator-production\\-mode.*?(\\s*)(?:\\-\\-\\>|\\*\\/)?(?: \\}?)?","gm"),f="\n$1$2$3\n",w=new RegExp("(?:\\{?\\s*)?(?:\\<\\!\\-\\-\\:|\\/\\*\\:|\\/\\/\\:)?(\\s*).*?\\@administrator\\-(?:development|production)\\-mode\\:(?:\\s*\\*\\/ \\}?)?\\s*([^]+?)\\s*(?:\\{?\\s*\\/\\*\\s*|\\/\\/\\:\\s*)?\\@end\\-administrator\\-(?:development|production)\\-mode.*?(\\s*)(?:\\-\\-\\>|\\*\\/)?(?: \\}?)?","gm"),h=new RegExp("(?:\\{?\\s*)?(?:\\<\\!\\-\\-\\:|\\/\\*\\:)?(\\s*).*?\\@[a-z\\-]*[a-z]\\-mode\\:(?:\\s*\\*\\/ \\}?)?\\s*([^]+?)\\s*(?:\\{?\\s*\\/\\*\\s*|\\/\\/\\:\\s*)?\\@end\\-[a-z][a-z\\-]*[a-z]\\-mode.*?(\\s*)(?:\\-\\-\\>|\\*\\/)?(?: \\}?)?","gm"),k=new RegExp("(?:\\{?\\s*\\/\\*\\:|\\;\\s*\\/\\/\\:)?\\s*\\@template\\:\\s*([^\\s]+)\\s*(?:\\*\\/ \\}?)?"),j=new RegExp("(?:\\{?\\s*\\/\\*\\:|\\;\\s*\\/\\/\\:)?\\s*\\@sub-template\\:\\s*([^\\s]+)\\s*(?:\\*\\/ \\}?)?"),x=argv.appName||e.appName,q=null,$=null;if(argv.production)q=a,$=u;else{if(!argv.development)throw new Error("no mode provided");q=n,$=o}var _=null,z=null;argv.administrator?(_=m,z=b,d="\n"):(_=m,z="\n");var E=null,R=null;argv.administrator&&argv.production?(E=v,R=f):argv.administrator&&argv.development?(E=g,R=y):(E=w,R="\n");for(var M=(argv.custom||e.custom||"","\n$1$2$3\n"),S=new RegExp("(?:\\{?\\s*)?(?:\\<\\!\\-\\-\\:|\\/\\*\\:|\\/\\/\\:)?(\\s*).*?"+"\\@custom\\-mode\\:(?:\\s*\\*\\/ \\}?)?\\s*([^]+?)\\s*".replace("custom",argv.custom)+"(?:\\{?\\s*\\/*\\s*|\\/\\/\\:\\s*)?\\@end\\-custom\\-mode".replace("custom",argv.custom)+".*?(\\s*)(?:\\-\\-\\>|\\*\\/)?(?: \\}?)?","gm"),P="./";!fs.existsSync(path.resolve(P,"script-list.js"));)P="../"+P;var B=path.resolve(P,"script-list.js"),C=e.scriptList||require(B);gulp.task("default",["clean-library","clean-build","clean-deploy","copy-library","build-library","deploy-library","build-font","deploy-font","build-script","deploy-script","build-less","build-style","deploy-style","build-image","deploy-image","build-index","deploy-index"]),gulp.task("clean",["clean-library","clean-build","clean-deploy","clean-temp"]),gulp.task("clean-temp",function(){return gulp.src("temp",{read:!1}).pipe(plumber()).pipe(vinylPaths(del))}),gulp.task("link-library",["clean-library","copy-library"]),gulp.task("clean-library",function(){return gulp.src("client/library",{read:!1}).pipe(plumber()).pipe(changed("temp/library")).pipe(vinylPaths(del))});var F=["bower_components/*/*.css","bower_components/*/*.map","bower_components/*/*.js","bower_components/*/*.eot","bower_components/*/*.svg","bower_components/*/*.ttf","bower_components/*/*.woff","bower_components/*/dist/**/*.eot","bower_components/*/dist/**/*.svg","bower_components/*/dist/**/*.ttf","bower_components/*/dist/**/*.woff","bower_components/*/dist/**/*.css","bower_components/*/dist/**/*.map","bower_components/*/dist/**/*.js","bower_components/*/lib/**/*.js","bower_components/*/build/**/*.js","bower_components/*/build/**/*.css","bower_components/*/css/*.css","bower_components/*/fonts/*.eot","bower_components/*/fonts/*.svg","bower_components/*/fonts/*.ttf","bower_components/*/fonts/*.woff"];gulp.task("copy-library",["clean-library"],function(){return gulp.src(F.concat(e.libraryExceptions)).pipe(plumber()).pipe(cached("library",{optimizeMemory:!0})).pipe(flatten()).pipe(gulp.dest("temp/library")).pipe(changed("temp/library")).pipe(gulp.dest("client/library"))}),gulp.task("build",["clean-build","build-script","build-library","build-font","build-less","build-style","build-image","build-index"]),gulp.task("clean-build",["clean-library","copy-library"],function(){var e=["build"];return argv.custom&&e.push(["build",argv.custom].join("-")),gulp.src(e,{read:!1}).pipe(plumber()).pipe(changed("client")).pipe(vinylPaths(del))}),gulp.task("build-script",["clean-build"],function(){var e=gulp.src(C).pipe(plumber()).pipe(cached("script:build",{optimizeMemory:!0})).pipe(map(function(e,p){for(var l=e.contents.toString("utf8"),r=(l.match(k)||[])[1];r;)r=path.resolve(P,"client",r),l=l.replace(k,[" (",fs.readFileSync(r),");"].join("\n")),r=(l.match(k)||[])[1];e.contents=new Buffer(l),p(null,e)})).pipe(map(function(e,p){for(var l=e.contents.toString("utf8"),r=(l.match(j)||[])[1];r;)r=path.resolve(P,"client",r),l=l.replace(j,["",fs.readFileSync(r),""].join("\n")),r=(l.match(j)||[])[1];e.contents=new Buffer(l),p(null,e)})).pipe(react()).pipe(replace(q,$)).pipe(replace(E,R)).pipe(replace(_,z)).pipe(replace(c,d));argv.custom&&(e=e.pipe(replace(S,M))),e=e.pipe(replace(h,"")).pipe(remember("script:build")).pipe(sourcemaps.init()).pipe(concat([x,"js"].join("."))).pipe(gulp.dest("build/script"));var p="";return argv.custom&&(p="build/script".replace("build",["build",argv.custom].join("-")),e=e.pipe(gulp.dest(p))),e=e.pipe(uglify()).pipe(rename([x,"min","js"].join("."))).pipe(sourcemaps.write("./")).pipe(gulp.dest("build/script")),argv.custom?e.pipe(gulp.dest(p)):e}),gulp.task("build-library",["clean-library","copy-library","clean-build"],function(){var e=gulp.src("client/library/*.*").pipe(plumber()).pipe(cached("library:build",{optimizeMemory:!0})).pipe(gulp.dest("build/library"));if(argv.custom){var p="build/library".replace("build",["build",argv.custom].join("-"));return e.pipe(gulp.dest(p))}return e}),gulp.task("build-font",["build-library"],function(){var e=gulp.src(["client/library/*.eot","client/library/*.svg","client/library/*.ttf","client/library/*.woff"]).pipe(plumber()).pipe(cached("font:build",{optimizeMemory:!0})).pipe(gulp.dest("client/fonts")).pipe(gulp.dest("build/fonts"));if(argv.custom){var p="build/fonts".replace("build",["build",argv.custom].join("-"));return e.pipe(gulp.dest(p))}return e}),gulp.task("build-less",["clean-build"],function(){return gulp.src("client/style/*.less").pipe(plumber()).pipe(cached("less:build",{optimizeMemory:!0})).pipe(remember("less:build")).pipe(less()).pipe(filter(["app.css"])).pipe(rename([x,"css"].join("."))).pipe(gulp.dest("temp/style"))}),gulp.task("build-style",["clean-build","build-less"],function(){var e=gulp.src("temp/style/*.css").pipe(plumber()).pipe(gulp.dest("build/style")),p="";return argv.custom&&(p="build/style".replace("build",["build",argv.custom].join("-")),e=e.pipe(gulp.dest(p))),e=e.pipe(sourcemaps.init()).pipe(minifyCSS({keepBreaks:!0})).pipe(rename([x,"min","css"].join("."))).pipe(sourcemaps.write("./")).pipe(gulp.dest("build/style")),argv.custom?e.pipe(gulp.dest(p)):e}),gulp.task("build-image",["clean-build"],function(){var e=gulp.src("client/image/*.*").pipe(plumber()).pipe(cached("image:build",{optimizeMemory:!0})).pipe(gulp.dest("build/image"));if(argv.custom){var p="build/image".replace("build",["build",argv.custom].join("-"));return e.pipe(gulp.dest(p))}return e}),gulp.task("build-index",["clean-build"],function(){var e=gulp.src("client/index.html").pipe(plumber()).pipe(replace(p,t)).pipe(replace(l,s)).pipe(replace(r,".")).pipe(replace(i,".")).pipe(replace(n,o)).pipe(replace(E,R)).pipe(replace(_,z)).pipe(replace(c,d));if(argv.custom&&(e=e.pipe(replace(S,M))),e=e.pipe(replace(h,"")).pipe(embedlr()).pipe(gulp.dest("build")),argv.custom){var a=["build",argv.custom].join("-");return e.pipe(gulp.dest(a))}return e}),gulp.task("deploy",["clean-deploy","deploy-script","deploy-library","deploy-font","deploy-style","deploy-image","deploy-index"]),gulp.task("clean-deploy",["clean-library","copy-library","clean-build","build-library"],function(){var e=["deploy"];return argv.custom&&e.push(["deploy",argv.custom].join("-")),gulp.src("deploy",{read:!1}).pipe(plumber()).pipe(vinylPaths(del))}),gulp.task("deploy-script",["clean-build","build-script","clean-deploy"],function(){var e=gulp.src(["build/script/*.js","build/script/*.map"]).pipe(plumber()).pipe(cached("script:deploy",{optimizeMemory:!0})).pipe(gulp.dest("deploy/script"));if(argv.custom){var p="deploy/script".replace("deploy",["deploy",argv.custom].join("-"));return e.pipe(gulp.dest(p))}return e}),gulp.task("deploy-library",["clean-library","copy-library","clean-build","build-library","clean-deploy"],function(){var e=gulp.src("build/library/*.*").pipe(plumber()).pipe(cached("library:deploy",{optimizeMemory:!0})).pipe(gulp.dest("deploy/library"));if(argv.custom){var p="deploy/library".replace("deploy",["deploy",argv.custom].join("-"));return e.pipe(gulp.dest(p))}return e}),gulp.task("deploy-font",["deploy-library"],function(){var e=gulp.src(["build/library/*.eot","build/library/*.svg","build/library/*.ttf","build/library/*.woff"]).pipe(plumber()).pipe(cached("font:deploy",{optimizeMemory:!0})).pipe(gulp.dest("deploy/fonts"));if(argv.custom){var p="deploy/fonts".replace("deploy",["deploy",argv.custom].join("-"));return e.pipe(gulp.dest(p))}return e}),gulp.task("deploy-style",["clean-build","build-less","build-style","clean-deploy"],function(){var e=gulp.src(["build/style/*.css","build/style/*.map"]).pipe(plumber()).pipe(cached("style:deploy",{optimizeMemory:!0})).pipe(gulp.dest("deploy/style"));if(argv.custom){var p="deploy/style".replace("deploy",["deploy",argv.custom].join("-"));return e.pipe(gulp.dest(p))}return e}),gulp.task("deploy-image",["clean-build","clean-deploy"],function(){var e=gulp.src("build/image/*.*").pipe(plumber()).pipe(cached("image:deploy",{optimizeMemory:!0})).pipe(gulp.dest("deploy/image"));if(argv.custom){var p="deploy/image".replace("deploy",["deploy",argv.custom].join("-"));return e.pipe(gulp.dest(p))}return e}),gulp.task("deploy-index",["clean-deploy"],function(){var e=gulp.src("client/index.html").pipe(plumber()).pipe(replace(p,t)).pipe(replace(l,s)).pipe(replace(a,u)).pipe(replace(E,R)).pipe(replace(_,z)).pipe(replace(c,d));if(argv.custom&&(e=e.pipe(replace(S,M))),e=e.pipe(replace(h,"")).pipe(gulp.dest("deploy")),argv.custom){var r=["deploy",argv.custom].join("-");return e.pipe(gulp.dest(r))}return e}),gulp.task("server-static",function(e){var p=process.config.port||process.env.PORT||8e3,l=connect();l.use(serveStatic("build")).listen(p,"localhost",e)}),gulp.task("reload",["build"],function(e){livereload.reload(),e()}),gulp.task("watch",["clean-build","build-script","build-library","build-font","build-less","build-style","build-image","build-index","server-static"],function(){livereload.listen(),gulp.watch(["client/script/**","client/style/**","client/template/**","client/index.html",B].concat(F),["reload"])}),gulp.task("serverless-watch",["clean-build","build-script","build-library","build-font","build-less","build-style","build-image","build-index"],function(){livereload.listen(),gulp.watch(["client/script/**","client/style/**","client/template/**","client/index.html",B].concat(F),["reload"])})};module.exports=terraforma;
//# sourceMappingURL=terraforma.min.js.map